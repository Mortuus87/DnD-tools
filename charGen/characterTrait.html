<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>

    <nav class="navbar navbar-expand-xs navbar-dark bg-dark text-light">
        <div class="container">
            <h5>Navbar headline</h5>
            <h6>dropdown for nav to other generators [NYI]</h6>
        </div>
    </nav>

    <div class="container">
        <h1>5th edition NPC generator</h1>
        <p id="output"></p>
    </div>
    <!-- -->
    
    
    <!-- START OF SCRIPTS -->
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script>
        $.getJSON( "NpcTables.json", function( data ) {
            randomProperties(data);
        });
        
        function random(r) {
            //random number between 0 and n-1
            //input length of array to return random index of given array
            //i.e. input of 10 = output of 0-9
            return Math.floor(Math.random() * r);
        }
        
        function randomProperties(data) {
            let randAbilityHigh = random(data.abilityHigh.length);
            let randAbilityLow = random(data.abilityLow.length);
            let alignment = random(9); // 9 is the number of alignments used
            while (randAbilityHigh == randAbilityLow) {randAbilityLow = random(data.abilityLow.length)} //Ensure that strength and weakness is not the same
            
            let html = "";
            html += "<strong>Apperance: </strong>"+data.apperance[random(data.apperance.length)]+"<br>";
            html += "<strong>Strong attribute: </strong>"+data.abilityHigh[randAbilityHigh]+"<br>";
            html += "<strong>Weak attribute: </strong>"+data.abilityLow[randAbilityLow]+"<br>";
            html += "<strong>Talent: </strong>"+data.talent[random(data.talent.length)]+"<br>";
            html += "<strong>Mannerism: </strong>"+data.mannerism[random(data.mannerism.length)]+"<br>";
            html += "<strong>Interaction trait: </strong>"+data.interactionTrait[random(data.interactionTrait.length)]+"<br>";
            html += determineAlignment(data, alignment)+"<br>";
            html += "<strong>Bond: </strong>"+determineBond(data)+"<br>";
            html += "<strong>Flaw or secret: </strong>"+data.secret[random(data.secret.length)]+"<br>";
            $('#output').append(html);
            
            function determineBond() {
                let r1 = random(data.bond.length+1);
                let r2 = random(data.bond.length);
                let r3 = random(data.bond.length);
                
                while (r3 == r2) {
                    r2 = random(data.bond.length-1)
                }
                if (r1 < data.bond.length) {
                    return data.bond[r2];
                } else {
                    return data.bond[r2]+"<br><strong>Additional bond: </strong>"+data.bond[r3];
                }
            };
            function determineAlignment(){
                // the 9 is hardcoded based on number of possible alignments
                switch (alignment) {
                    case 0:
                    return "<strong>Lawful good: </strong>"+data.ideal.lawful[random(data.ideal.lawful.length)]+" and "+data.ideal.good[random(data.ideal.good.length)];
                    break;
                    case 1:
                    return "<strong>Neutral good: </strong>"+data.ideal.neutral[random(data.ideal.neutral.length)]+" and "+data.ideal.good[random(data.ideal.good.length)];
                    break;
                    case 2:
                    return "<strong>Chaotic good: </strong>"+data.ideal.chaotic[random(data.ideal.chaotic.length)]+" and "+data.ideal.good[random(data.ideal.good.length)];
                    break;
                    case 3:
                    return "<strong>Lawful neutral: </strong>"+data.ideal.lawful[random(data.ideal.lawful.length)]+" and "+data.ideal.neutral[random(data.ideal.neutral.length)];
                    break;
                    case 4:
                    return "<strong>True neutral: </strong>"+data.ideal.neutral[random(data.ideal.neutral.length)]+" and "+data.ideal.other[random(data.ideal.other.length)];
                    break;
                    case 5:
                    return "<strong>Chaotic neutral: </strong>"+data.ideal.chaotic[random(data.ideal.chaotic.length)]+" and "+data.ideal.neutral[random(data.ideal.neutral.length)];
                    break;
                    case 6:
                    return "<strong>Lawful evil: </strong>"+data.ideal.lawful[random(data.ideal.lawful.length)]+" and "+data.ideal.evil[random(data.ideal.evil.length)];
                    break;
                    case 7:
                    return "<strong>Neutral evil: </strong>"+data.ideal.neutral[random(data.ideal.neutral.length)]+" and "+data.ideal.evil[random(data.ideal.evil.length)];
                    break;
                    case 8:
                    return "<strong>Chaotic evil: </strong>"+data.ideal.chaotic[random(data.ideal.chaotic.length)]+" and "+data.ideal.evil[random(data.ideal.evil.length)];
                    break;
                    default: return "Error in alignment ideal picker";
                    break;
                }
            };
            
        }        
    </script>
</body>
</html>